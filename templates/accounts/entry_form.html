{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Add Milk Entry</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Select2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
  
  <style>
    body { background: #f8f9fa; }
    .form-container { max-width: 700px; margin: 40px auto; background: white; padding: 24px; border-radius: 8px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
    .form-title { color: #007bff; font-weight: bold; margin-bottom: 24px; }
    .form-label { font-weight: 600; color: #333; }
    .error-message { color: #dc3545; font-size: 13px; margin-top: 6px; }
    .form-text { font-size: 12px; color: #6c757d; margin-top: 4px; }
    .btn-group-row { display: flex; gap: 10px; margin-top: 24px; }
    .btn-group-row button, .btn-group-row a { flex: 1; padding: 10px; }
    .select2-container--bootstrap-5 .select2-selection { border: 1px solid #dee2e6; border-radius: 4px; height: auto; }
    .select2-container--bootstrap-5.select2-container--focus .select2-selection { border-color: #0d6efd; box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25); }
  </style>
</head>
<body>
  <div class="form-container">
    <h3 class="form-title">‚ûï Add Daily Milk Entry</h3>

    <form method="post" novalidate>
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="alert alert-danger alert-dismissible fade show">
          {% for e in form.non_field_errors %}
            <div>{{ e }}</div>
          {% endfor %}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endif %}

      

      <!-- OR CREATE NEW CUSTOMER -->
      <div class="mb-4">
        <label for="new_customer_input" class="form-label">
          Create New Customer
        </label>
        {{ form.customer_name }}
        {% if form.customer_name.errors %}
          <div class="error-message">
            {% for e in form.customer_name.errors %}{{ e }}{% endfor %}
          </div>
        {% endif %}
        <div class="form-text">Type a customer name  on save.</div>
      </div>

      <!-- DATE -->
      <div class="mb-4">
        <label for="id_date_input" class="form-label">
          <span class="text-danger">*</span> Date
        </label>
        {{ form.date }}
        {% if form.date.errors %}
          <div class="error-message">
            {% for e in form.date.errors %}{{ e }}{% endfor %}
          </div>
        {% endif %}
        <div class="form-text">Select the date milk was delivered</div>
      </div>

      <!-- QUANTITY -->
      <div class="mb-4">
        <label for="id_quantity_input" class="form-label">
          <span class="text-danger">*</span> Quantity (ml)
        </label>
        {{ form.quantity_ml }}
        {% if form.quantity_ml.errors %}
          <div class="error-message">
            {% for e in form.quantity_ml.errors %}{{ e }}{% endfor %}
          </div>
        {% endif %}
        <div class="form-text">Enter milk quantity in millilitres (e.g., 500, 1000)</div>
      </div>

      <!-- SUBMIT & CANCEL -->
      <div class="btn-group-row">
        <button type="submit" class="btn btn-success btn-lg">
          <strong>üíæ Save Entry</strong>
        </button>
        <a href="{% url 'accounts:customer_list' %}" class="btn btn-secondary btn-lg">
          <strong>‚ùå Cancel</strong>
        </a>
      </div>
    </form>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Select2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      // Initialize Select2 on customer dropdown
      $('#id_customer_select').select2({
        theme: 'bootstrap-5',
        placeholder: '-- Search & select customer --',
        allowClear: true,
        width: '100%'
      });

      const custSelect = document.getElementById('id_customer_select');
      const custInput = document.getElementById('new_customer_input');
      const dateInput = document.getElementById('id_date_input');

      // UX: clear new name if existing selected
      if (custSelect) {
        custSelect.addEventListener('change', function(){
          if (this.value) {
            custInput.value = '';
          }
        });
      }

      // UX: clear select if new name typed
      if (custInput) {
        custInput.addEventListener('input', function(){
          if (this.value.trim().length) {
            custSelect.value = null;
            $('#id_customer_select').trigger('change');
          }
        });
      }

      // UX: set default date to today
      if (dateInput && !dateInput.value) {
        dateInput.value = new Date().toISOString().split('T')[0];
      }
    });
  </script>
</body>
</html>